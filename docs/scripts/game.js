!function(){"use strict";let e,t=0,n=null;const i=[261.63,329.63,392,523.25,392,329.63,293.66,349.23,440,587.33,440,349.23];function startBackgroundMusic(){if(e||(e=new(window.AudioContext||window.webkitAudioContext)),"suspended"===e.state&&e.resume(),n)return;const t=[261.63,329.63,392,523.25,392,349.23,293.66,349.23,440,587.33,440,392,261.63,293.66,329.63,349.23],i=[130.81,130.81,146.83,146.83,174.61,174.61,196,196];let a=0,o=0;function playLeadNote(t){const n=e.createOscillator(),i=e.createGain();n.type="square",n.frequency.setValueAtTime(t,e.currentTime),i.gain.setValueAtTime(.06,e.currentTime),i.gain.exponentialRampToValueAtTime(.001,e.currentTime+.25),n.connect(i),i.connect(e.destination),n.start(),n.stop(e.currentTime+.3)}function playBassNote(t){const n=e.createOscillator(),i=e.createGain();n.type="triangle",n.frequency.setValueAtTime(t,e.currentTime),i.gain.setValueAtTime(.03,e.currentTime),i.gain.exponentialRampToValueAtTime(.001,e.currentTime+.4),n.connect(i),i.connect(e.destination),n.start(),n.stop(e.currentTime+.5)}n=setInterval((()=>{playLeadNote(t[a%t.length]),a%2==0&&(playBassNote(i[o%i.length]),o++),a++}),300)}const a=document.getElementById("gameCanvas"),o=a.getContext("2d");let l=[];function generateStars(){l=Array.from({length:100},(()=>({x:Math.random()*a.width,y:Math.random()*a.height,radius:2*Math.random(),speed:.5*Math.random()+.2})))}function resizeCanvas(){const e=a.parentElement,t=getComputedStyle(e),n=parseFloat(t.paddingLeft)+parseFloat(t.paddingRight),i=parseFloat(t.paddingTop)+parseFloat(t.paddingBottom),o=400;a.width=e.clientWidth-n,a.height=Math.min(e.clientHeight-i,o),generateStars()}window.addEventListener("resize",resizeCanvas),resizeCanvas();let r=7;const h=7,s=2,d=4,c=1.5,f=18e5,y=1e3,u=80,x=5;let w=0,p=100,m=[],g=[],M=[],v=0,T,A=[],E=!1,S=!1,B=!0,k=!1,C=[],L=3,b=1,D=["⚡","🔫","🏃","❤️"],G=1e3,R=0;function drawStartMenu(){o.fillStyle="white",o.font="36px sans-serif",o.textAlign="center",o.fillText("opdev1004's",a.width/2,a.height/2-100),o.fillText("Space Game",a.width/2,a.height/2-60),o.font="24px sans-serif",o.fillStyle="gray",o.fillRect(a.width/2-60,a.height/2,120,40),o.fillStyle="white",o.fillText("Start",a.width/2,a.height/2+20)}const I={x:a.width/2,y:a.height-60,width:20,height:20};let F=I.x,z=I.y;function handleClick(e){e.preventDefault();const t=a.getBoundingClientRect(),n=(e.touches?e.touches[0].clientX:e.clientX)-t.left,i=(e.touches?e.touches[0].clientY:e.clientY)-t.top,o=a.width/2-60,l=a.height/2,r=120,h=undefined;if(!k&&n>=o&&n<=o+r&&i>=l&&i<=l+40)return startBackgroundMusic(),k=!0,void restartGame();!B&&n>=o&&n<=o+r&&i>=l+30&&i<=l+70&&restartGame()}function handleInput(e){e.preventDefault();const t=a.getBoundingClientRect(),n=e.touches?e.touches[0].clientX:e.clientX,i=e.touches?e.touches[0].clientY:e.clientY;F=n-t.left,z=i-t.top,shootBullet()}function drawPlayer(){o.font="24px serif",o.textAlign="center",o.textBaseline="middle",o.fillText("🚀",I.x,I.y)}function shootBullet(){const e=Date.now();if(e-w>p){const t=10,n=I.x;for(let e=0;e<b;e++){const i=(e-Math.floor(b/2))*t;m.push({x:n+i,y:I.y})}w=e}}function drawBullets(){o.fillStyle="yellow",m.forEach((e=>{o.fillRect(e.x-2,e.y-10,4,10),e.y-=7})),m=m.filter((e=>e.y>0))}function spawnEnemy(){const e=Math.random()*(a.width-20)+10;g.push({x:e,y:-30,size:40,shootCooldown:3e3*Math.random()+1e3})}function drawEnemies(e){g.forEach((t=>{if(o.font="28px serif",o.textAlign="center",o.textBaseline="middle",o.fillText("👾",t.x,t.y),t.y+=2,t.shootCooldown-=e,t.shootCooldown<=0){const e=I.x-t.x,n=I.y-t.y,i=Math.hypot(e,n);M.push({x:t.x,y:t.y,dx:e/i*4,dy:n/i*4}),t.shootCooldown=3e3*Math.random()+1e3}})),g=g.filter((e=>e.y<a.height+20))}function drawEnemyBullets(){M.forEach((e=>{o.fillStyle=e.fromBoss?"magenta":"orange";const t=e.fromBoss?16:10;o.fillRect(e.x-t/2,e.y-t/2,t,t),e.x+=e.dx,e.y+=e.dy})),M=M.filter((e=>e.y>=0&&e.y<=a.height&&e.x>=0&&e.x<=a.width))}function downgrade(){if(!Math.random()<.2)return;const e=[];if(b>1&&e.push("bullet"),p<100&&e.push("cooldown"),r>7&&e.push("speed"),e.length>0){const t=undefined;switch(e[Math.floor(Math.random()*e.length)]){case"bullet":b--;break;case"cooldown":p+=10;break;case"speed":r-=1;break}}}function checkCollisions(){m.forEach(((e,t)=>{g.forEach(((n,i)=>{if(Math.hypot(e.x-n.x,e.y-n.y)<n.size/2){if(m.splice(t,1),g.splice(i,1),Math.random()<.2){const e=D[Math.floor(Math.random()*D.length)];C.push({x:n.x,y:n.y,type:e,createdAt:Date.now(),vx:2*(Math.random()-.5),vy:2*(Math.random()-.5)})}v+=10}})),A.forEach((n=>{if(!n.dead&&e.x>n.x&&e.x<n.x+n.width&&e.y>n.y&&e.y<n.y+n.height&&(m.splice(t,1),n.hp--,n.hp<=0)){const e=D[Math.floor(Math.random()*D.length)];C.push({x:n.x,y:n.y,type:e,createdAt:Date.now(),vx:2*(Math.random()-.5),vy:2*(Math.random()-.5)}),v+=100,n.dead=!0}}))})),g.forEach(((e,t)=>{Math.hypot(I.x-e.x,I.y-e.y)<(e.size+I.width)/2&&downgrade()})),M.forEach((e=>{e.x>I.x-10&&e.x<I.x+10&&e.y>I.y&&e.y<I.y+20&&(M.splice(M.indexOf(e),1),L>0?L--:endGame(!1),downgrade())})),A.forEach((e=>{!e.dead&&I.x>e.x&&I.x<e.x+e.width&&I.y>e.y&&I.y<e.y+e.height&&downgrade()}))}function drawItems(){const e=Date.now();C=C.filter((t=>e-t.createdAt<15e3)),C.forEach((e=>{o.font="24px serif",o.textAlign="center",o.textBaseline="middle",o.fillText(e.type,e.x,e.y),e.x+=e.vx,e.y+=e.vy,(e.x<0||e.x>a.width)&&(e.vx*=-1),(e.y<0||e.y>a.height)&&(e.vy*=-1),Math.hypot(I.x-e.x,I.y-e.y)<20&&(applyItemEffect(e.type),e.collected=!0)})),C=C.filter((e=>!e.collected))}function applyItemEffect(e){switch(e){case"⚡":p>30&&(p-=10);break;case"🔫":b<30&&b++;break;case"🏃":r<20&&(r+=1);break;case"❤️":L++;break}}function drawBoss(e,t){if(e&&!e.dead&&(o.font="48px serif",o.textAlign="center",o.textBaseline="middle",o.fillText("🛸",e.x+e.width/2,e.y+e.height/2),e.x+=e.vx,e.y+=e.vy,(e.x<0||e.x+e.width>a.width)&&(e.vx*=-1),(e.y<0||e.y+e.height>a.height/2)&&(e.vy*=-1),e.shootCooldown-=t,e.shootCooldown<=0)){for(let t=-1;t<=1;t++){const n=I.x-(e.x+e.width/2)+20*t,i=I.y-(e.y+e.height/2),a=Math.hypot(n,i);M.push({x:e.x+e.width/2,y:e.y+e.height/2,dx:n/a*4,dy:i/a*4,fromBoss:!0})}for(let t=0;t<12;t++){const n=2*Math.PI/12*t;M.push({x:e.x+e.width/2,y:e.y+e.height/2,dx:4*Math.cos(n),dy:4*Math.sin(n),fromBoss:!0})}e.shootCooldown=2e3}}function updatePlayer(){const e=F-I.x,t=z-I.y,n=Math.hypot(e,t),i=r;n>i?(I.x+=e/n*i,I.y+=t/n*i):(I.x=F,I.y=z)}function drawScoreAndTime(){o.fillStyle="white",o.font="20px sans-serif";const e=Math.max(0,f-(Date.now()-T)),t=Math.ceil(e/1e3);o.textAlign="left",o.fillText(`Score: ${v}`,10,30),o.textAlign="right",o.fillText(`Time: ${t}s`,a.width-10,30),o.textAlign="left",o.fillText(`Lives: ${L}`,10,60)}function endGame(e){E=!e,S=e,B=!1}function drawEndScreen(){o.fillStyle="rgba(0, 0, 0, 0.8)",o.fillRect(0,0,a.width,a.height),o.fillStyle="white",o.font="36px sans-serif",o.textAlign="center",o.fillText("opdev1004's",a.width/2,a.height/2-160),o.fillText("Space Game",a.width/2,a.height/2-120),o.fillStyle="white",o.font="28px sans-serif",o.textAlign="center",o.textBaseline="middle",o.fillText(E?"Game Over":"You Survived!",a.width/2,a.height/2-60),o.font="24px sans-serif",o.fillText(`Final Score: ${v}`,a.width/2,a.height/2-20),o.fillStyle="gray",o.fillRect(a.width/2-60,a.height/2+20,120,40),o.fillStyle="white",o.fillText("Restart",a.width/2,a.height/2+40)}function restartGame(){m=[],g=[],M=[],C=[],v=0,A=[],P=0,E=!1,S=!1,B=!0,I.x=a.width/2,I.y=a.height-60,r=7,p=100,b=1,L=3,T=Date.now()}function drawBackground(){o.fillStyle="black",o.fillRect(0,0,a.width,a.height),o.fillStyle="white",l.forEach((e=>{o.beginPath(),o.arc(e.x,e.y,e.radius,0,2*Math.PI),o.fill(),e.y+=e.speed,e.y>a.height&&(e.y=0)}))}a.addEventListener("mousemove",handleInput),a.addEventListener("click",handleClick),a.addEventListener("touchstart",handleClick),a.addEventListener("touchmove",handleInput),window.addEventListener("keydown",(e=>{["ArrowLeft","ArrowRight","ArrowUp","ArrowDown"," "].includes(e.key)&&e.preventDefault(),k||" "!==e.key&&"Spacebar"!==e.key?B||" "!==e.key&&"Spacebar"!==e.key||restartGame():(startBackgroundMusic(),k=!0,restartGame())}));let P=0,q=Date.now();function gameLoop(){const e=Date.now(),t=e-q;if(q=e,drawBackground(),g.length<5&&e-R>G&&(spawnEnemy(),R=e,G>400&&(G-=1)),!k)return drawStartMenu(),void requestAnimationFrame(gameLoop);const n=e-T;if(!B)return drawEndScreen(),void requestAnimationFrame(gameLoop);if(updatePlayer(),drawPlayer(),drawBullets(),drawEnemies(t),drawEnemyBullets(),A.forEach((e=>drawBoss(e,t))),drawItems(),drawScoreAndTime(),checkCollisions(),n>f&&endGame(!0),n>2e4*(P+1)){const e=1+n/6e4*.1,t=Math.floor(u*e);A.push({x:Math.random()*(a.width-100),y:50,width:150,height:80,hp:t,vx:c*(Math.random()>.5?1:-1),vy:c*(Math.random()>.5?1:-1),shootCooldown:1e3,dead:!1}),P++}requestAnimationFrame(gameLoop)}setInterval(spawnEnemy,y),T=Date.now(),gameLoop()}();
